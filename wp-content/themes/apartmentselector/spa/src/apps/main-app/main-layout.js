// Generated by CoffeeScript 1.7.1
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['extm'], function(Extm) {
  var MainController, mainView;
  MainController = (function(_super) {
    __extends(MainController, _super);

    function MainController() {
      this._getView = __bind(this._getView, this);
      this.showRegionViews = __bind(this.showRegionViews, this);
      return MainController.__super__.constructor.apply(this, arguments);
    }

    MainController.prototype.initialize = function() {
      var layout;
      this.layout = layout = this._getView();
      App.layout = this.layout;
      this.listenTo(layout, 'show', this.showRegionViews);
      return this.show(layout);
    };

    MainController.prototype.showRegionViews = function() {
      var params;
      App.filter(params = {});
      msgbus.showApp('header').insideRegion(App.headerRegion).withOptions();
      return msgbus.showApp('screen:one').insideRegion(this.layout.screenOneRegion).withOptions();
    };

    MainController.prototype._getView = function() {
      return new mainView({
        templateHelpers: {
          SITEURL: SITEURL
        }
      });
    };

    return MainController;

  })(Extm.RegionController);
  mainView = (function(_super) {
    __extends(mainView, _super);

    function mainView() {
      return mainView.__super__.constructor.apply(this, arguments);
    }

    mainView.prototype.template = '<nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right" id="cbp-spmenu-s2"> <h3>My Menu</h3> <ul> <li ><a href="#"><span class="glyphicon glyphicon-heart"></span> Wishlist</a> <ul class="menuWishlist" id="showWishlist"> <li><a href="#">Wishlist 1</a></li> <li><a href="#">Wishlist 2</a></li> </ul> </li> </ul> <a href="#" id="compare" >Compare</a> </nav> <nav class="cbp-spmenu cbp-spmenu-horizontal cbp-spmenu-top" id="cbp-spmenu-s3"> <div class="row m-l-0 m-r-0"> <div class="col-sm-3"> <!--<h3>Additional Filters</h3>--> <div class="small blockTitle">Select Position</div> <div class="floorPlan"></div> </div> <div class="col-sm-3 b-l b-r b-grey"> <div class="small blockTitle">Select View</div> <div class="filterBox"> <input type="checkbox" name="fliter1" id="fliter1" class="checkbox" value="0"/> <label for="fliter1">Filter 1</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter2" id="fliter2" class="checkbox" value="0"/> <label for="fliter2">Filter 2</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter3" id="fliter3" class="checkbox" value="0"/> <label for="fliter3">Filter 3</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter4" id="fliter4" class="checkbox" value="0"/> <label for="fliter4">Filter 4</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter5" id="fliter5" class="checkbox" value="0"/> <label for="fliter5">Filter 5</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter6" id="fliter6" class="checkbox" value="0"/> <label for="fliter6">Filter 6</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter7" id="fliter7" class="checkbox" value="0"/> <label for="fliter7">Filter 7</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter8" id="fliter8" class="checkbox" value="0"/> <label for="fliter8">Filter 8</label> </div> <div class="clearfix"></div> </div> <div class="col-sm-3 b-r b-grey"> <div class="small blockTitle">Select Facing</div> <div class="filterBox"> <input type="checkbox" name="fliter9" id="fliter9" class="checkbox" value="0"/> <label for="fliter9">Filter 9</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter10" id="fliter10" class="checkbox" value="0"/> <label for="fliter10">Filter 10</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter11" id="fliter11" class="checkbox" value="0"/> <label for="fliter11">Filter 11</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter12" id="fliter12" class="checkbox" value="0"/> <label for="fliter12">Filter 12</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter13" id="fliter13" class="checkbox" value="0"/> <label for="fliter13">Filter 13</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter14" id="fliter14" class="checkbox" value="0"/> <label for="fliter14">Filter 14</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter15" id="fliter15" class="checkbox" value="0"/> <label for="fliter15">Filter 15</label> </div> <div class="filterBox"> <input type="checkbox" name="fliter16" id="fliter16" class="checkbox" value="0"/> <label for="fliter16">Filter 16</label> </div> <div class="clearfix"></div> </div> <div class="col-sm-3 summaryBox"> <div class="small blockTitle">Option Selected</div> <div class="section"> <div class="small">Position</div> 5 </div> <div class="section"> <div class="small">View</div> Lake, Garden </div> <div class="section"> <div class="small">Facing</div> SE </div> <a href="#" class="btn btn-primary m-t-20 m-b-10" id="">Apply</a> </div> </div> </nav> <div id="screen-one-region" > </div> <div id="screen-two-region" > </div> <div id="screen-three-region" > </div> <div id="screen-four-region" > </div>';

    mainView.prototype.events = {
      'click #compare': function(e) {
        var body, menuRight, menuTop, showRightPush, showTop, win;
        console.log($.cookie("key"));
        win = window.open(SITEURL + "/wishlist/#wishList", '_blank');
        win.focus();
        menuRight = document.getElementById("cbp-spmenu-s2");
        menuTop = document.getElementById("cbp-spmenu-s3");
        showTop = document.getElementById("showTop");
        showRightPush = document.getElementById("showRightPush");
        body = document.body;
        classie.toggle(showRightPush, "active");
        classie.toggle(body, "cbp-spmenu-push-toleft");
        return classie.toggle(menuRight, "cbp-spmenu-open");
      },
      'click .del': function(e) {
        var index, val;
        console.log(App.cookieArray = App.cookieArray);
        console.log(val = $('#' + e.target.id).attr('data-id'));
        console.log(index = App.cookieArray.indexOf(parseInt(val)));
        App.cookieArray.splice(index, 1);
        $.cookie('key', App.cookieArray);
        localStorage.setItem("cookievalue", App.cookieArray);
        $('#errormsg').text("");
        return this.showWishList();
      },
      'click a': function(e) {
        return e.preventDefault();
      },
      'click .selectedunit': function(e) {
        var body, buildingModel, floorriserange, menuRight, menuTop, object, rangeArrayVal, rangeModel, showRightPush, showTop, unitModel;
        menuRight = document.getElementById("cbp-spmenu-s2");
        menuTop = document.getElementById("cbp-spmenu-s3");
        showTop = document.getElementById("showTop");
        showRightPush = document.getElementById("showRightPush");
        body = document.body;
        classie.toggle(showRightPush, "active");
        classie.toggle(body, "cbp-spmenu-push-toleft");
        classie.toggle(menuRight, "cbp-spmenu-open");
        App.unit['name'] = $('#' + e.target.id).attr('data-id');
        App.unit['flag'] = 1;
        console.log($('#' + e.target.id).attr('data-id'));
        console.log(unitModel = App.master.unit.findWhere({
          id: parseInt($('#' + e.target.id).attr('data-id'))
        }));
        App.defaults['unitType'] = unitModel.get('unitType');
        App.defaults['building'] = unitModel.get('building');
        console.log(rangeModel = App.master.range);
        App.backFilter['screen3'].push("floor");
        App.backFilter['screen2'].push("floor", "unitVariant");
        console.log(buildingModel = App.master.building.findWhere({
          id: unitModel.get('building')
        }));
        floorriserange = buildingModel.get('floorriserange');
        object = this;
        rangeArrayVal = [];
        $.each(floorriserange, function(index, value) {
          var end, i, start;
          rangeArrayVal = [];
          i = 0;
          start = parseInt(value.start);
          end = parseInt(value.end);
          while (parseInt(start) <= parseInt(end)) {
            rangeArrayVal[i] = start;
            start = parseInt(start) + 1;
            i++;
          }
          console.log(rangeArrayVal);
          if (jQuery.inArray(parseInt(unitModel.get('floor')), rangeArrayVal) >= 0) {
            console.log("aaaaaaaaaaa");
            return App.defaults['floor'] = rangeArrayVal.join(',');
          }
        });
        console.log(App.defaults);
        App.navigate("screen-four");
        msgbus.showApp('header').insideRegion(App.headerRegion).withOptions();
        return msgbus.showApp('screen:four').insideRegion(App.layout.screenFourRegion).withOptions();
      }
    };

    mainView.prototype.regions = {
      screenOneRegion: '#screen-one-region',
      screenTwoRegion: '#screen-two-region',
      screenThreeRegion: '#screen-three-region',
      screenFourRegion: '#screen-four-region'
    };

    mainView.prototype.onShow = function() {
      var cookieOldValue, height;
      console.log(height = $(window).scrollTop());
      $(window).scroll(function() {
        height = $(window).scrollTop();
        if (height < 300) {
          $('.backBtn').addClass('hidden');
          return $('.slctnTxt').addClass('hidden');
        } else {
          $('.backBtn').removeClass('hidden');
          return $('.slctnTxt').removeClass('hidden');
        }
      });
      console.log(cookieOldValue = $.cookie("key"));
      console.log(typeof cookieOldValue);
      if (cookieOldValue === void 0 || $.cookie("key") === "") {
        cookieOldValue = [];
      } else {
        console.log(cookieOldValue = $.cookie("key").split(',').map(function(item) {
          return parseInt(item);
        }));
      }
      App.cookieArray = cookieOldValue;
      localStorage.setItem("cookievalue", App.cookieArray);
      return this.showWishList();
    };

    mainView.prototype.showWishList = function() {
      var building, element, model, selectedUnitsArray, table, unitType, unitVariant, _i, _len;
      table = "";
      console.log(typeof $.cookie("key"));
      if ($.cookie("key") !== void 0 && $.cookie("key") !== "") {
        selectedUnitsArray = $.cookie("key").split(",");
        table = "<table>";
        for (_i = 0, _len = selectedUnitsArray.length; _i < _len; _i++) {
          element = selectedUnitsArray[_i];
          model = App.master.unit.findWhere({
            id: parseInt(element)
          });
          unitType = App.master.unit_type.findWhere({
            id: model.get('unitType')
          });
          unitVariant = App.master.unit_variant.findWhere({
            id: model.get('unitVariant')
          });
          building = App.master.building.findWhere({
            id: model.get('building')
          });
          table += '<li><a href="#" id="unit' + element + '" data-id="' + element + '" class="selectedunit">' + model.get('name') + '</a> <a href="#" class="del" id="' + element + '" data-id="' + element + '"  ></a></li> <div class="clearfix"></div>';
        }
        table += '</table>';
      }
      console.log(table);
      return $('#showWishlist').html(table);
    };

    return mainView;

  })(Marionette.LayoutView);
  return msgbus.registerController('main:app', MainController);
});
